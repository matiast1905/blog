{
  "hash": "4e1aca247e90b4ba70b14498da975914",
  "result": {
    "markdown": "---\ntitle: \"Pell Grant Program Data Analysis\"\nauthor: \"Matias Taron Simoes\"\ndate: \"2022-09-02\"\nformat: html\nimage: \"thumbnail.jpg\"\ndescription: \"Data Analysis of the US Pell grant program, this data came from the #TidyTuesday project.\"\ncategories: [Data Analysis, EDA, TidyTuesday]\n---\n\n\n## 1. Program Description\n\nFederal Pell Grants usually are awarded only to undergraduate students who display exceptional financial need and have not earned a bachelor's, graduate, or professional degree. (In some cases, however, a student enrolled in a postbaccalaureate teacher certification program might receive a Federal Pell Grant.) You are not eligible to receive a Federal Pell Grant if you are incarcerated in a federal or state penal institution or are subject to an involuntary civil commitment upon completion of a period of incarceration for a forcible or nonforcible sexual offense.\n\nA Federal Pell Grant, unlike a loan, does not have to be repaid, except under certain circumstances.\n\nYou can read more info about the Pell grant in the [official site of the grant](https://studentaid.gov/understand-aid/types/grants/pell)\n\n## 2. Where do we get the data?\n\nThe data comes from the [#TidyTuesday](https://github.com/rfordatascience/tidytuesday/tree/master/data/2022/2022-08-30) project, courtesy of the [US Department of Education](https://www2.ed.gov/finaid/prof/resources/data/pell-institution.html).\n\nThe data is already packaged in an R package called `{Pell}` hosted in [CRAN](https://curious-joe.github.io/pell/articles/intro.html).\n\nThis [package vignette](https://curious-joe.github.io/pell/articles/download.html) talks in more detail about the data and how it was sourced. To check out how the data was sourced and cleaned check download data directly page in the vignette.\n\n### Data dictionary\n\n| Variable  | Class   | Description                              |\n|:----------|:--------|:-----------------------------------------|\n| STATE     | integer | State short code                         |\n| AWARD     | double  | Award amount in USD                      |\n| RECIPIENT | double  | Total number of recipients by year, name |\n| NAME      | integer | Name of college/university               |\n| SESSION   | integer | Session group                            |\n| YEAR      | integer | Year                                     |\n\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n:::\n\n\n### Sample of the data\n\n\n::: {.cell}\n::: {.cell-output-display}\n|state |    award| recipient|name                              |session | year|\n|:-----|--------:|---------:|:---------------------------------|:-------|----:|\n|GA    |  5791500|      2083|Gordon College                    |2008-09 | 2008|\n|TN    | 16118052|      4373|Northeast State Community College |2010-11 | 2010|\n|AR    |  1234915|       286|Lyon College                      |2010-11 | 2010|\n|NE    |  1070906|       438|Nebraska Wesleyan University      |2002-03 | 2002|\n|FL    |   422189|       193|Heritage Institute                |2004-05 | 2004|\n:::\n:::\n\n\n## 3. Exploratory Data Analysis\n\n### 3.1 Grants awarded by year\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngrants_awarded_by_year <- \n  pell |> \n    count(year, wt = recipient)\n\ngrants_awarded_by_year |> \n  ggplot(aes(year, n)) +\n  geom_col() +\n  scale_y_continuous(labels = comma) +\n  labs(y = \"# of Pell grants awarded\",\n       x = \"Year\")\n```\n\n::: {.cell-output-display}\n![](pell_grant_program_files/figure-html/unnamed-chunk-2-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n:::\n\n\nWe can see a peak in the amount of grants awarded in 2011, with 9,444,368 total grants\n\n### 3.2 Grants per state\n\nThe data come with the abbreviation of the state. To make a better plot, we will need the full name of the state. For this, I'm going to use the `state.name` and `state.abb` datasets that come in the `{datasets}` package. There are some missing states in this dataset, which we will fill manually. These are `PR` for *Puerto Rico* and and `DC` for *District of Columbia*. The rest of the missing states will be filtered out.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nstates <- \n  tibble(state = c(state.abb,\"PR\",\"DC\"),\n         state_name = c(state.name,\"Puerto Rico\",\"District of Columbia\"))\n\npell_states <- \n  pell |> \n    inner_join(states, by = \"state\")\n\nglue(\"Dimensions of the pell dataset: [{ dim(pell)[1] }, { dim(pell)[2] }]\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nDimensions of the pell dataset: [100474, 6]\n```\n:::\n\n```{.r .cell-code}\nglue(\"Dimensions of the pell dataset with states names: [{ dim(pell_states)[1] }, { dim(pell_states)[2] }]\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nDimensions of the pell dataset with states names: [100295, 7]\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\npell_states |> \n  count(state_name, wt = recipient, sort = TRUE) |>\n  head(15) |>\n  mutate(state_name = fct_reorder(state_name, n)) |> \n  ggplot(aes(n, state_name)) +\n  geom_col() +\n  scale_x_continuous(labels = comma) +\n  labs(y = \"\",\n       x = \"Grants awarded between 1999-2017\",\n       title = \"Top 15 states with the most Pell grants awarded\")\n```\n\n::: {.cell-output-display}\n![](pell_grant_program_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n\nSince we have state data and a period of time, probably makes sense to make a choropleth map animated by year. For this, I will use the `{ggplot2}` package, which have a function to plot maps and it's easy to use.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmap_data(\"state\") |>\n  slice_sample(n = 5) |> \n  knitr::kable()\n```\n\n::: {.cell-output-display}\n|       long|      lat| group| order|region      |subregion |\n|----------:|--------:|-----:|-----:|:-----------|:---------|\n|  -76.67321| 38.22202|    19|  5842|maryland    |NA        |\n|  -81.34855| 37.31674|    55| 14097|virginia    |main      |\n| -114.08163| 36.13645|    30|  8571|nevada      |NA        |\n|  -76.24923| 44.04900|    35|  9176|new york    |main      |\n|  -91.23779| 33.57533|    26|  7695|mississippi |NA        |\n:::\n:::\n\n\nFor using it, you just have to assign the `long` column to the *x* value, the `lat` column to the *y* value, and the `group` column to the *group* value in ggplot2, as shown below.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmap_data(\"state\") |>\n  ggplot(aes(long, lat, group = group)) +\n  geom_polygon(fill = \"gray50\", alpha = 0.5, color = \"black\") +\n  coord_map() +\n  ggthemes::theme_map()\n```\n\n::: {.cell-output-display}\n![](pell_grant_program_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n:::\n\n\nNow we need to fill the states with the values we want to show. In the map_data dataframe, the names of the states are all lowercase, whereas in our data the names are title case, that's something to consider when joining both dataframes.\n\nFirst, I will make a map for only one year, to be sure everything works fine.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nby_state_count <- \n  pell_states |> \n    count(state_name, year, wt = recipient)\n\nby_state_count |> \n  filter(year == 2017) |>\n  mutate(region = str_to_lower(state_name)) |> \n  right_join(map_data(\"state\"), by = \"region\") |> \n  ggplot(aes(long, lat, group = group, fill = n)) +\n  geom_polygon() +\n  scale_fill_viridis_c(option = \"E\",\n                      trans = \"log10\",\n                       breaks = 8*10^seq(3,5),\n                       labels = comma(8*10^seq(3,5)))+\n  coord_map() +\n  ggthemes::theme_map()+\n  labs(fill = \"\",\n       title = \"Pell grants awarded in **2017**\") +\n  theme(legend.position = \"bottom\",\n        plot.title = element_markdown(size = 15, hjust = 0.5))\n```\n\n::: {.cell-output-display}\n![](pell_grant_program_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n:::\n\n\nNow that we know this works, we can make and animation with `{gganimate}`\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(gganimate)\n\np <- by_state_count |> \n  mutate(region = str_to_lower(state_name)) |> \n  right_join(map_data(\"state\"), by = \"region\") |> \n  ggplot(aes(long, lat, group = group, fill = n)) +\n  geom_polygon() +\n  scale_fill_viridis_c(option = \"E\",\n                      trans = \"log10\",\n                       breaks = 8*10^seq(3,5),\n                       labels = comma(8*10^seq(3,5)))+\n  coord_map() +\n  ggthemes::theme_map()+\n  transition_manual(year) +\n  labs(fill = \"\",\n       title = \"Pell grants awarded in **{current_frame}**\") +\n  theme(legend.position = \"bottom\",\n        plot.title = element_markdown(size = 15, hjust = 0.5))\n\nanimate(p, duration = 12)\n```\n\n::: {.cell-output-display}\n![](pell_grant_program_files/figure-html/unnamed-chunk-9-1.gif)\n:::\n:::\n",
    "supporting": [
      "pell_grant_program_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}